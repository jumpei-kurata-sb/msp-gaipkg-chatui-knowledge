# msp-gaipkg-chatui-knowledge

このリポジトリは、mbox 形式のメールデータを RAG（検索拡張生成）用に前処理するためのスクリプトとサンプルデータを含みます。

## 主なファイル

- `extract_mbox.py`: mbox ファイルからメール本文・メタデータを抽出し、CSV/Markdown 形式で出力します。
- `Hack Discussion.mbox`: サンプルのメールボックスデータ。
- `out.md`, `out.csv`, `out.json`, `out.jsonl`: 抽出結果のサンプル。

## 使い方

```bash
python3 extract_mbox.py --input "Hack Discussion.mbox" --output "out.md"
```

## メールのノイズ（引用・署名・返信ヘッダ等）の自動削除について

### 機能概要

`extract_mbox.py` は、メール本文から以下のような「ノイズ」（AI 処理時に不要な部分）を自動で削除します：

- 過去メールの引用（行頭が `>` の行）
- 返信・転送ヘッダ（例: `-----Original Message-----`, `On ... wrote:`, `From: ...`, `Sent: ...` など）
- 日本語の返信日付（例: `2025年5月23日(金) ...`）
- 署名区切り（行のみが `--`）以降

### 仕組み

正規表現とヒューリスティックルールで、上記パターンを検出し、
・引用行はスキップ
・返信/転送ヘッダや日付が現れたらその行以降を切り捨て
・署名区切り以降も切り捨て
としています。

### 例

#### 元のメール本文（一部抜粋）

```
お疲れ様です。

> お忙しいところご回答いただきありがとうございます。
> File Searchも含めて連携機能有効になるとのことで承知いたしました。

-----Original Message-----
From: 生成AIパッケージ Hack <grp-mspgaipkghack@g.softbank.co.jp>
Sent: 2025年5月22日(木) 17:22
To: 権守 伸也
Subject: Re: ...

...（過去メール引用）...
```

#### クリーニング後の本文

```
お疲れ様です。

```

### 注意点・限界

- ルールベースのため、まれに本文中の「From:」や日付表記などで誤って切り捨てる場合があります。
- 複雑なインライン返信や、引用直後に追記がある場合は意図しない削除が起こることがあります。
- 重要な文脈が引用部に含まれる場合は、必要に応じて元データも参照してください。

### 目的・効果

- RAG や埋め込み生成時に、ノイズを除去することで AI の精度向上・コスト削減が期待できます。

## 出力形式

各メールごとに、件名・送信者・宛先・CC・日付・本文を Markdown 形式で出力します。

## ライセンス

MIT
